<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Enduring Card Engine - Order Generator (v8)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body {
        margin: 0;
        padding: 20px;
        font-family: Arial, sans-serif;
        background: #111;
        color: #fff;
        text-align: center;
      }

      h1 {
        margin: 0 0 6px;
        color: #ff4d88;
      }
      .subtitle {
        margin: 0 0 16px;
        color: #ffbdd6;
        font-size: 0.95rem;
      }

      .engine {
        max-width: 900px;
        margin: 0 auto;
        background: #222;
        border-radius: 14px;
        padding: 20px;
        position: relative;
        text-align: center;
      }

      .logo {
        position: absolute;
        top: 15px;
        right: 15px;
        width: 130px;
        height: auto;
        border-radius: 8px;
      }

      label {
        display: block;
        margin-top: 12px;
        font-size: 0.92rem;
        color: #ffbdd6;
      }

      input,
      select,
      textarea {
        width: 100%;
        box-sizing: border-box;
        padding: 10px;
        margin-top: 6px;
        border: none;
        border-radius: 8px;
        background: #111;
        color: #fff;
        font-size: 0.95rem;
        text-align: center;
        outline: none;
      }

      textarea {
        min-height: 90px;
        resize: vertical;
      }

      .row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        margin-top: 10px;
      }

      .note {
        margin-top: 8px;
        font-size: 0.8rem;
        color: #bdbdbd;
      }

      .btnRow {
        margin-top: 16px;
        display: flex;
        gap: 10px;
        justify-content: center;
        flex-wrap: wrap;
      }

      button {
        padding: 12px 16px;
        border: none;
        border-radius: 999px;
        cursor: pointer;
        background: #ff4d88;
        color: #fff;
        font-weight: 800;
        font-size: 0.95rem;
      }

      button.secondary {
        background: #333;
        color: #e9e9e9;
        font-weight: 700;
      }

      .pricing {
        margin-top: 18px;
        background: #181818;
        border-radius: 12px;
        padding: 12px;
        text-align: center;
      }

      .pricing h3 {
        margin: 0 0 10px;
        color: #ffbdd6;
        font-size: 1rem;
      }

      .pRow {
        display: flex;
        justify-content: space-between;
        gap: 10px;
        font-size: 0.9rem;
        margin-top: 6px;
      }
      .pRow span {
        width: 50%;
      }
      .pRow span:last-child {
        text-align: right;
      }

      pre {
        margin-top: 14px;
        background: #000;
        padding: 14px;
        border-radius: 12px;
        max-height: 320px;
        overflow: auto;
        font-size: 0.8rem;
        text-align: left; /* JSON is easier to read left-aligned */
        white-space: pre-wrap;
        word-break: break-word;
      }

      .uploads {
        margin-top: 16px;
        background: #1a1a1a;
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 12px;
        padding: 12px;
      }

      .previewRow {
        margin-top: 10px;
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
      }

      .thumb {
        border-radius: 10px;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: #000;
        aspect-ratio: 1 / 1;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #aaa;
        font-size: 0.85rem;
        padding: 8px;
        text-align: center;
      }

      .thumb img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }

      .thumb video {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }

      @media (max-width: 720px) {
        .row {
          grid-template-columns: 1fr;
        }
        .previewRow {
          grid-template-columns: 1fr 1fr;
        }
      }
    </style>
  </head>

  <body>
    <h1>Enduring Card Engine</h1>
    <p class="subtitle">
      Any occasion • customer inputs • uploads + pricing • v8
    </p>

    <div class="engine">
      <img class="logo" src="enduringholdings.png" alt="Logo" />

      <!-- BASIC ORDER -->
      <label>Order ID</label>
      <input
        id="orderId"
        placeholder="ex: CARD-0001 (leave blank to auto-generate)"
      />
      <div class="btnRow" style="margin-top: 10px">
        <button class="secondary" type="button" onclick="autoOrderId()">
          Generate Order ID
        </button>
      </div>

      <div class="row">
        <div>
          <label>Customer Name</label>
          <input id="customerName" placeholder="Your name" />
        </div>
        <div>
          <label>Customer Email</label>
          <input id="customerEmail" placeholder="you@email.com" />
        </div>
      </div>

      <label>Recipient Name</label>
      <input id="recipientName" placeholder="Who is this for?" />

      <!-- ANY CARD -->
      <div class="row">
        <div>
          <label>Card Type</label>
          <select id="cardType">
            <option value="">Select</option>
            <option value="valentines">Valentine’s</option>
            <option value="anniversary">Anniversary</option>
            <option value="birthday">Birthday</option>
            <option value="wedding">Wedding</option>
            <option value="apology">Apology</option>
            <option value="congrats">Congrats</option>
            <option value="thank_you">Thank You</option>
            <option value="encouragement">Encouragement</option>
            <option value="memorial">Memorial</option>
            <option value="just_because">Just Because</option>
            <option value="custom">Custom</option>
          </select>
        </div>

        <div>
          <label>Color Theme</label>
          <select id="theme">
            <option value="">Select</option>
            <option value="pink_white">Pink &amp; White</option>
            <option value="black_pink">Black &amp; Pink</option>
            <option value="red_white">Red &amp; White</option>
            <option value="blue_red">Blue &amp; Red</option>
            <option value="custom">Custom</option>
          </select>
        </div>
      </div>

      <label>Occasion / Vibe (optional)</label>
      <input
        id="occasion"
        placeholder="ex: 5-year anniversary, long-distance, funny + romantic, etc."
      />

      <!-- TIER + COUNTS -->
      <div class="row">
        <div>
          <label>Service Tier</label>
          <select id="tier">
            <option value="">Select tier</option>
            <option value="1">Tier 1</option>
            <option value="2">Tier 2</option>
            <option value="custom">Custom</option>
          </select>
          <div class="note">Pricing auto-calculates below.</div>
        </div>
        <div>
          <label>Target Delivery Date</label>
          <input
            id="deliveryDate"
            type="text"
            placeholder="MM/DD/YYYY (ex: 02/14/2026)"
            inputmode="numeric"
          />
        </div>
      </div>

      <div class="row">
        <div>
          <label>Number of Photos</label>
          <input type="number" id="photos" min="0" />
        </div>
        <div>
          <label>Number of Songs</label>
          <input type="number" id="songs" min="0" />
        </div>
      </div>

      <label>Number of Videos</label>
      <input type="number" id="videos" min="0" />

      <!-- UPLOADS -->
      <div class="uploads">
        <h3 style="margin: 0 0 10px; color: #ffbdd6">
          Uploads (customer selects files)
        </h3>

        <label>Upload Photos (multiple)</label>
        <input id="photoFiles" type="file" accept="image/*" multiple />

        <label>Upload Videos (multiple)</label>
        <input id="videoFiles" type="file" accept="video/*" multiple />

        <div class="note">
          These uploads preview on this device. To actually RECEIVE the files
          automatically, you’ll connect a receiver backend (Jotform File Upload
          / Firebase Storage / etc.).
        </div>

        <div class="previewRow" id="previewRow"></div>
      </div>

      <!-- LINKS -->
      <div class="row">
        <div>
          <label>Spotify Playlist Link (optional)</label>
          <input
            id="playlistUrl"
            placeholder="https://open.spotify.com/playlist/..."
          />
        </div>
        <div>
          <label>YouTube Video Link (optional)</label>
          <input
            id="videoUrl"
            placeholder="https://www.youtube.com/watch?v=..."
          />
        </div>
      </div>

      <!-- MESSAGE -->
      <label>Headline / Title</label>
      <input id="headline" placeholder="ex: I Love You More Than Yesterday" />

      <label>Main Message (3 paragraphs recommended)</label>
      <textarea
        id="message"
        placeholder="Paragraph 1...

Paragraph 2...

Paragraph 3..."
      ></textarea>

      <label>Special Instructions</label>
      <textarea
        id="specialNotes"
        placeholder="ex: R&amp;B vibes, no cursing, mention year 1 memories, etc."
      ></textarea>

      <!-- DELIVERY -->
      <label>Delivery Method</label>
      <select id="deliveryMethod">
        <option value="">Select</option>
        <option value="email">Email</option>
        <option value="download_link">Download Link</option>
        <option value="both">Email + Download Link</option>
      </select>

      <!-- NOTIFICATIONS -->
      <label>Notification Emails (leave blank to use defaults)</label>
      <input
        id="notifyEmails"
        placeholder="ex: email1@gmail.com, email2@gmail.com"
      />
      <div class="note">
        Default notifications go to: aarondamar@gmail.com, maaron179@aol.com,
        theenduringinvestor@gmail.com, and your Boost SMS gateways. (Phone
        numbers alone cannot receive email unless converted to carrier SMS email
        format.)
      </div>

      <!-- PRICING DISPLAY -->
      <div class="pricing">
        <h3>Pricing (auto-calculated)</h3>
        <div class="pRow">
          <span>Base (by tier):</span><span id="basePriceDisplay">$0</span>
        </div>
        <div class="pRow">
          <span>Extra Photos (beyond 4):</span
          ><span id="photosPriceDisplay">$0</span>
        </div>
        <div class="pRow">
          <span>Extra Songs (beyond 4):</span
          ><span id="songsPriceDisplay">$0</span>
        </div>
        <div class="pRow">
          <span>Videos:</span><span id="videosPriceDisplay">$0</span>
        </div>
        <div class="pRow" style="font-weight: 900; margin-top: 8px">
          <span>Estimated Total:</span><span id="totalPriceDisplay">$0</span>
        </div>
        <div class="note" id="pricingSummary">
          Tier: – • Photos: 0 • Songs: 0 • Videos: 0
        </div>
      </div>

      <!-- BUTTONS -->
      <div class="btnRow">
        <button type="button" onclick="submitOrder()">Submit Order</button>
        <button type="button" class="secondary" onclick="copyJSON()">
          Copy JSON
        </button>
        <button type="button" class="secondary" onclick="clearFields()">
          Clear All
        </button>
        <button type="button" class="secondary" onclick="emailOrder()">
          Email Order
        </button>
      </div>

      <pre id="output">{ }</pre>
    </div>

    <script>
      // ---------------- PRICING ----------------
      const BASE_PRICES = { 1: 120, 2: 150, custom: 0 };
      const INCLUDED_PHOTOS = 4;
      const INCLUDED_SONGS = 4;
      const PHOTO_EXTRA_PRICE = 10;
      const SONG_EXTRA_PRICE = 10;
      const VIDEO_PRICE = 15;

      // Default inboxes + Boost SMS gateways (these work as email recipients)
      const DEFAULT_NOTIFICATION_EMAILS =
        "aarondamar@gmail.com, maaron179@aol.com, theenduringinvestor@gmail.com, 2156107641@sms.myboostmobile.com, 4453057249@sms.myboostmobile.com";

      // ---------------- HELPERS ----------------
      function val(id) {
        const el = document.getElementById(id);
        const v = el ? el.value : "";
        return v === "" ? null : v;
      }
      function num(id) {
        const el = document.getElementById(id);
        const v = el ? el.value : "";
        if (v === "") return null;
        const n = Number(v);
        return isNaN(n) ? null : n;
      }

      function updatePricingDisplay(
        basePrice,
        photosPrice,
        songsPrice,
        videosPrice,
        totalPrice
      ) {
        document.getElementById("basePriceDisplay").textContent =
          "$" + basePrice;
        document.getElementById("photosPriceDisplay").textContent =
          "$" + photosPrice;
        document.getElementById("songsPriceDisplay").textContent =
          "$" + songsPrice;
        document.getElementById("videosPriceDisplay").textContent =
          "$" + videosPrice;
        document.getElementById("totalPriceDisplay").textContent =
          "$" + totalPrice;
      }

      function updatePricingSummary(
        tier,
        photosCount,
        songsCount,
        videosCount
      ) {
        document.getElementById("pricingSummary").textContent =
          "Tier: " +
          (tier || "–") +
          " • Photos: " +
          (photosCount || 0) +
          " • Songs: " +
          (songsCount || 0) +
          " • Videos: " +
          (videosCount || 0);
      }

      function computePricing() {
        const tier = val("tier");
        const photosCount = num("photos") || 0;
        const songsCount = num("songs") || 0;
        const videosCount = num("videos") || 0;

        const basePrice = BASE_PRICES[tier] ?? 0;
        const extraPhotos = Math.max(photosCount - INCLUDED_PHOTOS, 0);
        const extraSongs = Math.max(songsCount - INCLUDED_SONGS, 0);

        const photosPrice = extraPhotos * PHOTO_EXTRA_PRICE;
        const songsPrice = extraSongs * SONG_EXTRA_PRICE;
        const videosPrice = videosCount * VIDEO_PRICE;

        const totalPrice = basePrice + photosPrice + songsPrice + videosPrice;

        updatePricingDisplay(
          basePrice,
          photosPrice,
          songsPrice,
          videosPrice,
          totalPrice
        );
        updatePricingSummary(tier, photosCount, songsCount, videosCount);

        return {
          tier,
          photosCount,
          songsCount,
          videosCount,
          basePrice,
          photosPrice,
          songsPrice,
          videosPrice,
          totalPrice,
        };
      }

      function autoOrderId() {
        if (document.getElementById("orderId").value.trim()) return;
        const now = new Date();
        const y = String(now.getFullYear()).slice(-2);
        const m = String(now.getMonth() + 1).padStart(2, "0");
        const d = String(now.getDate()).padStart(2, "0");
        const h = String(now.getHours()).padStart(2, "0");
        const min = String(now.getMinutes()).padStart(2, "0");
        document.getElementById(
          "orderId"
        ).value = `CARD-${y}${m}${d}-${h}${min}`;
      }

      // ---------------- UPLOAD PREVIEWS ----------------
      const previewRow = document.getElementById("previewRow");

      function clearPreviews() {
        previewRow.innerHTML = "";
      }

      function addThumb(node) {
        const wrap = document.createElement("div");
        wrap.className = "thumb";
        wrap.appendChild(node);
        previewRow.appendChild(wrap);
      }

      function previewFiles() {
        clearPreviews();

        const photoFiles = document.getElementById("photoFiles").files || [];
        const videoFiles = document.getElementById("videoFiles").files || [];

        // show up to 6 previews total
        let shown = 0;

        Array.from(photoFiles)
          .slice(0, 6)
          .forEach((f) => {
            if (shown >= 6) return;
            const img = document.createElement("img");
            img.src = URL.createObjectURL(f);
            img.onload = () => URL.revokeObjectURL(img.src);
            addThumb(img);
            shown++;
          });

        Array.from(videoFiles)
          .slice(0, 6 - shown)
          .forEach((f) => {
            if (shown >= 6) return;
            const vid = document.createElement("video");
            vid.src = URL.createObjectURL(f);
            vid.muted = true;
            vid.playsInline = true;
            vid.loop = true;
            vid.autoplay = true;
            vid.onloadeddata = () => {
              try {
                URL.revokeObjectURL(vid.src);
              } catch (e) {}
            };
            addThumb(vid);
            shown++;
          });

        if (shown === 0) {
          const msg = document.createElement("div");
          msg.textContent = "No previews yet.";
          addThumb(msg);
        }
      }

      document
        .getElementById("photoFiles")
        .addEventListener("change", previewFiles);
      document
        .getElementById("videoFiles")
        .addEventListener("change", previewFiles);

      // ---------------- JSON GENERATION ----------------
      function generateJSON() {
        const pricing = computePricing();

        // Capture file names (actual file transfer requires backend)
        const photoFiles = Array.from(
          document.getElementById("photoFiles").files || []
        );
        const videoFiles = Array.from(
          document.getElementById("videoFiles").files || []
        );

        const data = {
          engine: "Enduring Card Engine",
          version: "8.0",
          created_at: new Date().toISOString(),
          order: {
            id: val("orderId"),
            customer_name: val("customerName"),
            customer_email: val("customerEmail"),
            notification_emails:
              val("notifyEmails") || DEFAULT_NOTIFICATION_EMAILS,
          },
          card: {
            card_type: val("cardType"),
            occasion: val("occasion"),
            tier: pricing.tier,
            color_theme: val("theme"),
            recipient_name: val("recipientName"),
            headline: val("headline"),
            message: val("message"),
            assets: {
              photos_count: pricing.photosCount,
              songs_count: pricing.songsCount,
              videos_count: pricing.videosCount,
              included_photos: INCLUDED_PHOTOS,
              included_songs: INCLUDED_SONGS,

              // uploads (filenames only in static mode)
              uploaded_photos: photoFiles.map((f) => ({
                name: f.name,
                type: f.type,
                size: f.size,
              })),
              uploaded_videos: videoFiles.map((f) => ({
                name: f.name,
                type: f.type,
                size: f.size,
              })),

              // optional links
              playlist_url: val("playlistUrl"),
              video_url: val("videoUrl"),
            },
          },
          delivery: {
            method: val("deliveryMethod"),
            target_date: val("deliveryDate"),
          },
          pricing: {
            base_price: pricing.basePrice,
            photos_price: pricing.photosPrice,
            songs_price: pricing.songsPrice,
            videos_price: pricing.videosPrice,
            total_price: pricing.totalPrice,
          },
          notes: {
            special_instructions: val("specialNotes"),
          },
        };

        document.getElementById("output").textContent = JSON.stringify(
          data,
          null,
          2
        );
        return data;
      }

      function copyJSON() {
        const text = document.getElementById("output").textContent;
        if (!text || text.trim() === "{ }") {
          alert("Generate/Submit first.");
          return;
        }
        navigator.clipboard
          .writeText(text)
          .then(() => alert("JSON copied ✅"))
          .catch(() => alert("Copy failed — copy manually."));
      }

      function emailOrder() {
        const dataText = document.getElementById("output").textContent;
        if (!dataText || dataText.trim() === "{ }") {
          alert("Submit first.");
          return;
        }

        const emails = val("notifyEmails") || DEFAULT_NOTIFICATION_EMAILS;
        const subject = encodeURIComponent(
          "New Card Order " + (val("orderId") || "")
        );
        const body = encodeURIComponent(dataText);

        window.location.href = `mailto:${emails}?subject=${subject}&body=${body}`;
      }

      // ONE-TAP submit (generates JSON, saves locally for card.html if you use it)
      function submitOrder() {
        if (!document.getElementById("orderId").value.trim()) autoOrderId();
        generateJSON();

        // If you're using the auto-generated card page approach:
        localStorage.setItem(
          "ENDURING_LAST_ORDER_JSON",
          document.getElementById("output").textContent
        );

        alert(
          "Order created ✅ (JSON generated). If you want file uploads to reach you automatically, connect a receiver backend like Jotform File Upload."
        );
      }

      function clearFields() {
        [
          "orderId",
          "customerName",
          "customerEmail",
          "recipientName",
          "cardType",
          "theme",
          "occasion",
          "tier",
          "photos",
          "songs",
          "videos",
          "playlistUrl",
          "videoUrl",
          "headline",
          "message",
          "specialNotes",
          "deliveryMethod",
          "deliveryDate",
          "notifyEmails",
        ].forEach((id) => {
          const el = document.getElementById(id);
          if (el) el.value = "";
        });

        // Clear file inputs
        document.getElementById("photoFiles").value = "";
        document.getElementById("videoFiles").value = "";
        clearPreviews();

        document.getElementById("output").textContent = "{ }";
        updatePricingDisplay(0, 0, 0, 0, 0);
        updatePricingSummary(null, 0, 0, 0);
      }

      // live pricing updates
      ["tier", "photos", "songs", "videos"].forEach((id) => {
        const el = document.getElementById(id);
        el.addEventListener("input", computePricing);
        el.addEventListener("change", computePricing);
      });

      // init
      computePricing();
      previewFiles();
    </script>
  </body>
</html>

